(()=>{"use strict";const t=t=>document.querySelector(t),e=e=>(e.__wrapped__||(e.__wrapped__=function(){try{return e.apply(this,arguments)}catch(e){t(".error-modal__explanation").textContent=e.message,o(".error-modal")}}),e.__wrapped__),r=e(((t,e)=>(e.style.border=t?"none":"2px solid red",t))),a=e=>{const r=t(e);r.style.display="none",document.body.style.overflow="",r.querySelectorAll("input").forEach((t=>t.value=""))},o=e=>{t(e).style.display="flex",document.body.style.overflow="hidden"},n=e=>{const r=t(e);r.addEventListener("click",(t=>{t.target!==r&&""!=t.target.getAttribute("data-close")||a(e)})),document.addEventListener("keydown",(t=>{"Escape"===t.code&&"flex"==r.style.display&&a(e)}))};class s{static isNumber=e(((t,e)=>{if("number"!=typeof t||isNaN(t))throw new TypeError("Element must be a number.");if(t>e)return t;throw new RangeError(`Number ${t} must be greater than ${e}`)}));static isDate=e((t=>{if(t=>new Date&&t instanceof Date&&!isNaN(t.valueOf()))return t;throw new Error("Invalid Date value")}));static isArray=e((t=>{if(Array.isArray(t))return t;throw new Error("Invalid Array")}));static isName=t=>/^[a-яА-яa-zA-ZіІЇїЄєґҐ ]{2,20}$/.test(t)}const c=(e,r)=>{t(".user-info__role").textContent=r,t(".user-info__name span").textContent=e.name,t(".user-info__balance span").textContent=`${e.balance} UAH`},i=(e,a)=>{const n=t(".products .prod-container__list");n.innerHTML="",a.forEach((a=>{const c=document.createElement("li");c.textContent=`${a.name} - ${a.price} UAH - ${a.totalAmount}`,c.onclick=()=>{o(".cart-modal"),t(".cart-modal__product").textContent=a.name,t(".cart-modal__btn").onclick=()=>{const o=t(".cart-modal__amount");r(s.isNumber(+o.value,0),o)&&(e.cart.addProduct(a,+o.value),t(".cart-modal").style.display="none",o.value=0,l(e))}},n.append(c)}))},l=e=>{const r=t(".cart  .prod-container__list");r.innerHTML="",e.cart.storage.forEach((({product:t,amount:a})=>{const o=document.createElement("li");o.innerHTML=`${t.name} - ${a}<span class="cross">X</span>`,r.append(o),o.querySelector(".cart .cross").onclick=t=>{const r=t.target.parentNode.textContent.split(" - ")[0];e.cart.removeProduct(r),l(e)}})),((e,r)=>{const a=e.cart.storage.reduce(((t,{product:e,amount:r})=>t+r*e.price),0);t(".cart__total-price span").textContent=`${a} UAH`})(e)};class u{constructor(t,e,r){this.name=t,this.price=e,this.totalAmount=r}substractAmount(t){if(!(t<=this.totalAmount))throw new Error("Insufficient quantity of goods.");this.totalAmount-=t}get name(){return this._name}set name(t){this._name=t}get price(){return this._price}set price(t){this._price=s.isNumber(t,0)}get totalAmount(){return this._totalAmount}set totalAmount(t){this._totalAmount=s.isNumber(t,-.001)}}class d{constructor(t){this._user=t,this._cartStorage=[]}get storage(){return this._cartStorage}addProduct(t,e){if(!(s.isNumber(e,0)&&t instanceof u))throw new Error("Invalid product value.");{const r=this._cartStorage.findIndex(((e,r,a)=>e.product==t));-1!=r?this._cartStorage[r].amount+=e:this._cartStorage.push({product:t,amount:e})}}removeProduct(t){0!=this._cartStorage.length&&t&&(this._cartStorage=this._cartStorage.filter((e=>e.product.name!=t)))}withdraw(){this._cartStorage.length=0}checkout(){if(0==this._cartStorage.length)throw new Error("Cart is empty.");const t=this._cartStorage.reduce(((t,{product:e,amount:r})=>t+r*e.price),0);this._user.addOrder(this._cartStorage,t,new Date)}}class m{constructor(t,e,r){this.products=t,this.totalPrice=e,this.date=r}get products(){return this._products}set products(t){this._products=s.isArray(t)}get totalPrice(){return this._totalPrice}set totalPrice(t){this._totalPrice=s.isNumber(t,0)}get date(){return this._date}set date(t){this._date=s.isDate(t)}}class h{constructor(t,e){this._orderHistory=[],this._cart=new d(this),this.name=t,this.balance=e}showOrderHistory(t,e="asc"){let r=this._orderHistory.sort(((e,r)=>"date"==t?e.date-r.date:"price"==t?e.totalPrice-r.totalPrice:void 0));return"desc"==e&&(r=r.reverse()),r}get cart(){return this._cart}addOrder(t,e,r){if(console.log(e,this.balance),!(e<=this.balance))throw new Error("Insufficient funds in the account.");this.balance-=e,t.map((({product:t,amount:e})=>t.substractAmount(e))),this.cart._cartStorage=[],this._orderHistory.push(new m(t,e,r))}get name(){return this._name}set name(t){if(!s.isName(t))throw new Error("Name must contain letters and spaces only.");this._name=t}get balance(){return this._balance}set balance(t){this._balance=s.isNumber(t,-.001)}}class _ extends h{createProduct(t,e,r){new Product(t,e,r)}}try{let d,m,p=[new u("Coca Cola",12.5,500),new u("Coca Cola Zero",12.5,400),new u("Sprite",11.5,750),new u("Medoff 0.5",110,50),new u("Globyno",22.5,100),new u("Parlament Aqua Blue",69.5,1e3),new u("LM Loft Blue",65,99),new u("Winston XStyle Blue",66,204),new u("Winston XStyle Grey",66,300)];t(".checkout").onclick=e((()=>{d.cart.checkout(),l(d),i(d,p),c(d,m)})),t(".withdraw").onclick=e((()=>{d.cart.withdraw(),l(d)})),t(".role").addEventListener("click",e((t=>{t.target.value&&(m=t.target.value,a(".role"),o(".sign-in"))}))),t(".sign-in").addEventListener("submit",e((e=>{e.preventDefault();const o=new FormData(e.target),n=Object.fromEntries(o.entries()),l=r(s.isName(n.userName),e.target.userName),u=r(s.isNumber(+n.userBalance,0),e.target.userBalance);l&&u&&("Admin"===m?(d=new _(n.userName,+n.userBalance),t(".user-info__add-product").style.display="block"):d=new h(n.userName,+n.userBalance),a(".sign-in"),document.querySelectorAll(".prod-container").forEach((t=>t.style.display="flex")),i(d,p),c(d,m))}))),t(".new-product-modal__btn").onclick=e((()=>{const e=t(".new-product-modal__name"),o=t(".new-product-modal__price"),n=t(".new-product-modal__amount"),c=r(s.isNumber(+n.value,0),n),l=r(s.isNumber(+o.value,0),o);if(c&&l){const t=new u(e.value,+o.value,+n.value);p.push(t),i(d,p),a(".new-product-modal")}})),t(".user-info__btn").onclick=e((()=>{const e=t(".sorting-field").value,r=t(".sorting-type").value;console.log(d.showOrderHistory(e,r)),alert("Check the console!")})),t(".user-info__add-product").onclick=e((()=>{o(".new-product-modal")})),n(".cart-modal"),n(".error-modal"),n(".new-product-modal")}catch(e){t(".error-modal__explanation").textContent=e.message,o(".error-modal")}})();
//# sourceMappingURL=bundle.js.map